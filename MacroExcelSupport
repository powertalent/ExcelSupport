Function MoveToFirstSheet()
    ActiveWorkbook.Sheets(1).Select
End Function

Function MoveToLastSheet()
    ActiveWorkbook.Sheets(ActiveWorkbook.Sheets.Count).Select
End Function

Sub Translate()
    SelectedValue = ActiveCell.Value
    If (SelectedValue = "") Then
        ThisWorkbook.Sheets(1).Range("A1").Value = GetClipBoardText()
    Else
        ThisWorkbook.Sheets(1).Range("A1").Value = ActiveCell.Value
    End If
        
    Pronunciation = ThisWorkbook.Sheets(1).Range("C1")
    Meaning = ThisWorkbook.Sheets(1).Range("B1")
    MsgBox (Pronunciation & vbNewLine & Meaning)
End Sub

Function GetClipBoardText() As String
   ' Microsoft Form 2.0 (FM2.0.dll)
   Dim DataObj As MSForms.DataObject
   Set DataObj = New MSForms.DataObject '<~~ Amended as per jp's suggestion

   On Error GoTo Whoa

   '~~> Get data from the clipboard.
   DataObj.GetFromClipboard

   '~~> Get clipboard contents
   myString = DataObj.GetText(1)
   GetClipBoardText = myString
   Exit Function
Whoa:
   GetClipBoardText = ""
End Function

Function KatakanaToHiragana(strKata As String) As String
    KatakanaToHiragana = StrConv(strKata, vbHiragana)
End Function

Function HiraganaToKatakana(strHira As String) As String
    HiraganaToKatakana = StrConv(strHira, vbKatakana)
End Function

Sub AutoGroupShape()
    Dim dic As New Dictionary
    Dim groupImage As New Dictionary
    Dim ws As Object
    Dim Sh As shape
    Dim temp As ClsRectInfo
    Dim strKey As String
    'Dim arr As Variant
    Dim arr() As Variant
    Dim splitarr As Variant
    
    On Error GoTo ErrorHandler
    
    If (MsgBox("This will update selected sheets of current workbook", vbYesNo, "do you want to process ?") = vbNo) Then
        Exit Sub
    End If
    For Each ws In Application.ActiveWorkbook.Windows(1).SelectedSheets
        index = 1
        ' xu ly ungroup image
        For Each Sh In ws.Shapes
            If Sh.Type = msoGroup Then
                Sh.Ungroup
            End If
        Next Sh
        
        ' xu ly change name de khong bi trung ten
        For Each Sh In ws.Shapes
            Sh.Name = Sh.Name & "_" & index
            index = index + 1
        Next Sh
        
        For Each Sh In ws.Shapes
            If (Sh.Type = msoPicture) Then
                Set temp = New ClsRectInfo
                temp.Top = Sh.Top
                temp.Left = Sh.Left
                temp.Width = Sh.Width
                temp.Height = Sh.Height
                dic.Add Sh.Name, temp
                With Sh
                    .Line.ForeColor.SchemeColor = 64
                    .Line.Visible = msoTrue
                    .Line.Weight = ZoomBoderWidth
                    .Line.Visible = msoTrue
                    .Line.Style = msoLineSingle
                End With
            End If
        Next Sh
        For Each Sh In ws.Shapes
            If (Sh.Type <> msoPicture And Sh.Type <> msoGroup) Then
            strKey = getParentImageName(dic, Sh)
                If (strKey <> "") Then
                    If (groupImage.Exists(strKey)) Then
                    groupImage.Item(strKey) = groupImage.Item(strKey) & "," & Sh.Name
                    Else
                    groupImage.Add strKey, strKey & "," & Sh.Name
                End If
                End If
            End If
        Next Sh
        
        For Each strImgNames In groupImage.items
            splitarr = Split(strImgNames, ",")
            ReDim Preserve arr(0 To UBound(splitarr))
            For i = 0 To UBound(splitarr)
                arr(i) = splitarr(i)
            Next i
            ws.Shapes.Range(arr).Group
        Next
    Next ws
    Exit Sub
    
ErrorHandler:
    WriteLog Err, "AutoGroupShape"
    'Resume Next
End Sub

Sub auto_open()
    Application.OnKey "^%{PGUP}", "MoveToFirstSheet"
    Application.OnKey "^%{PGDN}", "MoveToLastSheet"
    Application.OnKey "^q", "Translate"
End Sub
